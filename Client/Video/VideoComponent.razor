@namespace Oqtane.ChatHubs

@using Oqtane.ChatHubs.Services
@using Oqtane.Shared.Models

<style type="text/css">

    .video-items div:first-of-type {
        padding-left: 0px !important;
    }

    .video-items div:last-of-type {
        padding-right: 0px !important;
    }

    .video-resize-container-@ItemIndex {
        resize: both;
        overflow: auto;
        background-color: @_videoItemBackgroundColor;
    }

    .video-resize-container:hover .video-ellipsis {
        display: initial;
    }

    .video-ellipsis {
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        z-index: 1;
        display: initial;
    }

    .background-gradient-blue {
        background-image: linear-gradient(to bottom, rgba(255,255,255,1), rgba(49,94,182,1));
    }

    .background-gradient-red {
        background-image: linear-gradient(to bottom, rgba(255,255,255,1), rgba(182,94,49,1));
    }

</style>

<div class="bd-highlight video-item px-1">

    @if (ChatHubService.ConnectedUser.UserId == ChatHubRoom.CreatorId)
    {
        <div>
            <div class="video-resize-container-@ItemIndex position-relative">
                <div class="text-white mb-0 w-100 position-absolute video-ellipsis">
                    <small class="px-2 py-1">[loc.] @ChatHubRoom.Title [@ItemIndex]</small>
                </div>
                <video id="chathubs-video-local-@ChatHubRoom.Id" class="chathubs-video-local mb-0 w-100 h-100" style="min-width: 320px; min-height: 160px;" controls></video>
                <canvas id="chathubs-canvas-local-@ChatHubRoom.Id" class="chathubs-canvas-local bg-light d-none"></canvas>
            </div>
        </div>
    }
    else
    {
        <div>
            <div class="video-resize-container-@ItemIndex position-relative">
                <div class="text-white mb-0 w-100 position-absolute video-ellipsis">
                    <small class="px-2 py-1">[rem.] @ChatHubRoom.Title [@ItemIndex]</small>
                </div>
                <video id="chathubs-video-remote-@ChatHubRoom.Id" class="chathubs-video-remote mb-0 w-100 h-100" style="min-width: 320px; min-height: 160px;" controls></video>
                <canvas id="chathubs-canvas-remote-@ChatHubRoom.Id" class="chathubs-canvas-remote bg-light d-none"></canvas>
            </div>
        </div>
    }

</div>

@code {

    [Inject]
    public IChatHubService ChatHubService { get; set; }

    [Parameter]
    public ChatHubRoom ChatHubRoom { get; set; }

    [Parameter]
    public int ItemIndex { get; set; }

    private string[] _colors = new string[]
    {
        "Azure",
        "CadetBlue",
        "CornflowerBlue",
        "Coral",
        "DarkKhaki",
        "DarkSalmon",
        "DarkSeaGreen",
        "DarkSlateBlue",
        "DarkSlateGrey",
        "YellowGreen"
    };

    private string _videoItemBackgroundColor
    {
        get => this._colors[new Random().Next(0, this._colors.Count() - 1)];
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
    }

}
